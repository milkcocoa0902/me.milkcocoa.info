---
title: "ç”»åƒã‚’æ‰±ã†ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œã‚‹ã¨ãã¯ä½ç½®æƒ…å ±ã‚’æ¶ˆãã†"
emoji: "ğŸ‘Œ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: 
    - Kotlin
    - ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰
    - ä½ç½®æƒ…å ±
published: true
---

## ã“ã®è¨˜äº‹ã¯ãªã«ï¼Ÿ
ãªã«ã‹ã—ã‚‰ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œã£ãŸã¨ãã€ã¨ãã«ç”»åƒã‚’æ‰±ã†ã‚µãƒ¼ãƒ“ã‚¹ã§ç¬¬ä¸‰è€…ã«ç”»åƒãŒè¦‹ãˆã‚‹å ´åˆã¯ã€ä½ç½®æƒ…å ±ã‚’ã¡ã‚ƒã‚“ã¨å‰Šé™¤ã—ã‚ˆã†ã­ã¨ã„ã†ãŠè©±ã§ã™ã€‚çŠ¶æ³ã«ã‚ˆã‚Šã¾ã™ã­ã€‚

## ã©ã®ã‚ˆã†ãªã¨ãã«ä½ç½®æƒ…å ±ã‚’æ¶ˆã™ï¼Ÿ
é€†ã«ã©ã®ã‚ˆã†ãªã¨ãã«ä½ç½®æƒ…å ±ã‚’æ®‹ã—ã¦ã‚‚è‰¯ã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ

- ãƒ¦ãƒ¼ã‚¶ãŒæ˜ç¢ºã«ä½ç½®æƒ…å ±ã®åˆ©ç”¨ã®æ„æ€ã‚’ç¤ºã—ãŸã¨ã
- ã‚µãƒ¼ãƒ“ã‚¹ãŒä½ç½®æƒ…å ±ã®åˆ©ç”¨ã‚’å‰æã¨ã—ã¦ã„ã‚‹ã¨ã

ãã‚‰ã„ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ï¼Ÿ
ã“ã‚Œä»¥å¤–ã®å ´åˆã«ã‚‚ã‚ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€åŸºæœ¬çš„ã«ã¯è¨±å¯ã•ã‚Œã¦ã„ãªã„å ´åˆã‚’é™¤ã„ã¦ä½ç½®æƒ…å ±ã‚’å‰Šé™¤ã™ã‚‹ã¹ãã ã¨æ€ã„ã¾ã™ã€‚  
ç‰¹ã«ã€ã‚ãŸã—ãŒãƒªãƒªãƒ¼ã‚¹ã—ã¦ã„ã‚‹[ãºã£ãŸã‚“](https://zenn.dev/milkcocoa0902/articles/publish-pet-sns-app)ã¨ã„ã†ã‚¢ãƒ—ãƒªã§ã¯ã€å®¶ã§é£¼ã£ã¦ã„ã‚‹ãƒšãƒƒãƒˆãŒã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ãªã£ã¦ã„ã¦ç”»åƒã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚‚ã§ãã‚‹ã®ã§ã€ç¢ºå®Ÿã«å‰Šé™¤ã™ã‚‹ã¹ãã§ã™ã€‚å®¶ãƒãƒ¬ã™ã‚‹ã®ã§ã€‚


## ãã‚‚ãã‚‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã‚µãƒ¼ãƒã©ã¡ã‚‰ã§æ¶ˆã™ï¼Ÿ
æ­£ç›´ãªã¨ã“ã‚ã€ã“ã‚Œã«é–¢ã—ã¦ã¯å¥½ã¿ã®å•é¡Œãªã®ã‹ãªã¨æ€ã£ã¦ã„ã¾ã™ã€‚

ä¾‹ãˆã°ã‚µãƒ¼ãƒå´ã§æ¶ˆã—ã¦ã‚ã’ã‚Œã°ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã¯ä½•ã‚‚è€ƒãˆãšã«ç”»åƒã‚’é€ã£ã¦ã‚ã’ã‚Œã°è‰¯ã„ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ãŸã ã€ä½ç½®æƒ…å ±ã‚’æ¶ˆã™ã‹ã©ã†ã‹ã‚’åˆ¶å¾¡ã™ã‚‹ãªã‚‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã§ã‚ãŸã—ã¦ã‚ã’ãªã„ã¨ã„ã‘ãªã„ã§ã™ã­ã€‚  
ä¸€æ–¹ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§æ¶ˆã™ãªã‚‰ã€ã‚µãƒ¼ãƒå´ã¯ä½•ã‚‚è€ƒãˆãšã«ã‚‚ã‚‰ã£ãŸã‚‚ã®ã‚’ä¿å­˜ã™ã‚Œã°è‰¯ã„ã“ã¨ã«ãªã‚Šã¾ã™ãŒã€ä¾‹ãˆã°iOSã¨Androidã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ï¼ˆãã‚Œãã‚Œãƒã‚¤ãƒ†ã‚£ãƒ–ã§ï¼‰ç”¨æ„ã™ã‚‹ã®ã§ã‚ã‚Œã°ãã‚Œãã‚Œå®Ÿè£…ã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã­ã€‚

## å®Ÿè£…ä¾‹
ã“ã“ã§ã¯ã€ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã®Kotlinã§ã®å®Ÿè£…ä¾‹ã‚’ç¤ºã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚ã¡ãªã¿ã«ã€ä½¿ã£ã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯Javaè£½ã§ã™ã€‚ã“ã‚“ãªã¨ãã€Null Safeã‚’ä¿è¨¼ã—ã¥ã‚‰ã„ã®ã€ã‚‚ã«ã‚‡ã‚Šã¾ã™ã­ã€‚

ä½¿ã†ã®ã¯ `org.apache.commons:commons-imaging:1.0-alpha3`ã§ã™ã€‚  
JPEGã®ByteArrayãŒã‚ã£ãŸã¨ã—ã¦ã€

``` Kotlin : RemoveGpsData.kt
fun ByteArray.removeLocationMetadata(): ByteArray {
    val metaData = Imaging.getMetadata(this) ?: return this
    return (metaData as? JpegImageMetadata)?.let { jpegImageMetadata ->
        jpegImageMetadata.exif?.outputSet?.apply {
            gpsDirectory?.fields?.forEach { gpsTag ->
                removeField(gpsTag.tag)
            }
            findField(ExifTagConstants.EXIF_TAG_GPSINFO)?.let {
                removeField(ExifTagConstants.EXIF_TAG_GPSINFO)
            }
        }.run {
            ByteArrayOutputStream().use { baos ->
                BufferedOutputStream(baos).use { bos ->
                    ExifRewriter().updateExifMetadataLossless(this@removeLocationMetadata, bos, this)
                }
                baos.toByteArray()
            }
        }
    } ?: kotlin.run {
        this
    }
}
```
ã®ã‚ˆã†ã«å®Ÿè£…ã—ãŸã‚‚ã®ã‚’é€šã—ã¦ã‚ã’ã‚Œã°ä½ç½®æƒ…å ±ãŒå‰Šé™¤ã§ãã¦ã„ã‚‹ã¯ãšã§ã™ã€‚